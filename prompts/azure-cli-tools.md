# Feature: Azure CLI (az aks) Tools Integration

## Description
This feature implements MCP (Model Context Protocol) server tools that enable AI assistants to execute Azure CLI (`az aks`) commands directly through the AKS-MCP server. It provides a comprehensive set of Azure Kubernetes Service operations via command-line interface integration.

## How it Works
The server registers individual `az aks` commands as separate MCP tools, allowing AI assistants to execute specific Azure CLI operations with proper security validation and access control.

## Architecture

### Core Components
- **Command Registry** - Defines and categorizes az aks commands with descriptions and example arguments
- **Command Executor** - Executes az CLI commands with security validation and timeout protection
- **Security Validator** - Validates commands against configured access levels and prevents unauthorized operations
- **Tool Registration** - Registers az commands as MCP tools and manages tool lifecycle

### Command Categories
Commands are organized by access level:

1. **Read-Only Commands** (Available at all access levels)
   - `az aks show` - Show cluster details
   - `az aks list` - List clusters
   - `az aks get-versions` - Get available Kubernetes versions
   - `az aks nodepool list` - List node pools
   - `az aks nodepool show` - Show node pool details
   - `az aks check-network outbound` - Network connectivity checks

2. **Read-Write Commands** (Available at readwrite and admin access levels)
   - `az aks create` - Create new clusters
   - `az aks delete` - Delete clusters
   - `az aks scale` - Scale clusters
   - `az aks update` - Update cluster configuration
   - `az aks upgrade` - Upgrade cluster version
   - `az aks nodepool add/delete/scale/upgrade` - Node pool management

3. **Admin Commands** (Available only at admin access level)
   - `az aks get-credentials` - Get cluster credentials

4. **Account Management Commands** (Available at all access levels)
   - `az account list` - List subscriptions
   - `az login` - Authenticate with Azure
   - `az account set` - Set active subscription

## Requirements

### Prerequisites
- Azure CLI installed and accessible in PATH
- Valid Azure authentication (via `az login` or service principal)
- Appropriate Azure permissions for the operations being performed

### Dependencies
- **Azure CLI**: The `az` command-line tool must be installed
- **Security Validation**: All commands are validated against the configured access level
- **Shell Execution**: Commands are executed through secure shell process handling

## Implementation Details

### Tool Registration Process
1. Commands are defined with names, descriptions, and example arguments
2. Each command is registered as a separate MCP tool with standardized naming
3. Tool names are generated by replacing spaces with underscores (e.g., `az aks show` â†’ `az_aks_show`)
4. Tools are registered based on the server's access level configuration

### Security and Access Control
- **Access Level Validation**: Commands are filtered based on readonly/readwrite/admin access levels
- **Command Validation**: All commands must pass security validation before execution
- **Binary Validation**: Only `az` commands are allowed for execution
- **Timeout Protection**: Commands have configurable execution timeouts

### Command Execution Flow
1. AI assistant calls an az command tool with required arguments
2. Security validator checks if the command is allowed for the current access level
3. Command executor constructs and runs the az CLI command
4. Results are returned to the AI assistant in structured format

## Usage Examples

### Basic Cluster Information
```json
{
  "tool": "az_aks_show",
  "parameters": {
    "args": "--name myAKSCluster --resource-group myResourceGroup"
  }
}
```

### List All Clusters
```json
{
  "tool": "az_aks_list",
  "parameters": {
    "args": "--resource-group myResourceGroup"
  }
}
```

### Create New Cluster (readwrite/admin only)
```json
{
  "tool": "az_aks_create",
  "parameters": {
    "args": "--name myAKSCluster --resource-group myResourceGroup --node-count 1 --enable-addons monitoring --generate-ssh-keys"
  }
}
```

### Node Pool Management (readwrite/admin only)
```json
{
  "tool": "az_aks_nodepool_add",
  "parameters": {
    "args": "--cluster-name myAKSCluster --resource-group myResourceGroup --name nodepool2 --node-count 3"
  }
}
```

## Configuration

### Access Level Configuration
Set the access level when starting the server:
```bash
./aks-mcp --access-level readonly    # Only read operations
./aks-mcp --access-level readwrite   # Read and write operations
./aks-mcp --access-level admin       # All operations including credentials
```

### Timeout Configuration
Configure command execution timeout:
```bash
./aks-mcp --timeout 600  # 10 minutes timeout (default)
```
